#!/bin/bash
# TODO: Make this cross-platform?

readonly min_backlight="5"
readonly current="$(xbacklight | cut -d '.' -f1)"
if [[ "$current" -lt "$min_backlight" ]]; then
    xbacklight -set "$min_backlight"
fi

abort() {
    # Better to kill i3/x than to return an unlocked session.
    i3-msg exit
}

lock() {
    i3lock -c 000000 -f -n
    return $?
}

if ! lock; then
    # If at first we don't succeed...
    sleep 0.5
    lock || abort
fi
